{% extends 'base.html' %}
{% load static %}

{% block title %}My Profile{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/profile.css' %}">
{% endblock %}

{% block content %}
<div class="profilecontainer">

    <div class="profilehead">
        <h2>My Profile</h2>
        <p>View and manage your profile information.</p>
    </div>

    <div class="profilebody">
        <div class="formsection">

            {% if not profile %}
                <div class="account-info profile-empty">
                    <h5 class="empty-title">Profile not completed</h5>
                    <p class="empty-text">
                        Please complete your profile from the Meal Plan page.
                    </p>
                    <a href="/meals/" class="submit-btn empty-btn">
                         Meal Plan Page 
                    </a>
                </div>
            {% else %}
            
            <!-- Profile Image -->
                <div class="profile-image-wrapper">
                    <div class="profile-image-box">
                        {% if profile.image %}
                            <img class="profile-image" src="{{ profile.image.url }}" alt="{{ request.user.username }}">
                        {% else %}
                            <div class="profile-image-placeholder">{{ request.user.username|slice:":1"|upper }}</div>
                        {% endif %}
                    </div>
                </div>

            <!-- Account Info -->
                <div class="account-info">
                    <p><span class="info-label">Username</span><span class="info-value">{{ request.user.username }}</span></p>
                    <p><span class="info-label">Email</span><span class="info-value">{{ request.user.email }}</span></p>
                </div>

                {% if not edit_mode %}
                    <style>
                        input, select { pointer-events: none; opacity: 0.85; }
                    </style>
                {% endif %}

                <form method="POST" {% if edit_mode %}enctype="multipart/form-data"{% endif %}>
                    {% csrf_token %}
                    <div class="profilesection">
                        {% if edit_mode %}
                            <div class="form-group-box">
                                {{ form.image.label_tag }} {{ form.image }}
                            </div>
                        {% endif %}
                    </div>
                    <div class="form-group-box">
                        {{ form.age.label_tag }} {{ form.age }}
                        {{ form.activity_level.label_tag }} {{ form.activity_level }}
                    </div>

                    <div class="form-group-box">
                        {{ form.height_cm.label_tag }} {{ form.height_cm }}
                        {{ form.weight_kg.label_tag }} {{ form.weight_kg }}
                    </div>

                    <div class="form-group-box">
                        {{ form.goal.label_tag }} {{ form.goal }}
                        {{ form.gender.label_tag }} {{ form.gender  }}
                    </div>

                    {% if edit_mode %}
                        <button class="submit-btn w-100 mt-3">Save Changes</button>
                    {% else %}
                        <a href="?edit=true" class="submit-btn w-100 mt-3 edit-btn">Edit Profile</a>
                    {% endif %}
                </form>

            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
